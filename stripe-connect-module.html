<html>

<head>
  <title>Stripe Connect module documentation</title>
  <link rel="stylesheet" href="/public/style.css" />
  <script async="" src="/public/highlight.min.js"></script>
  <script src="/public/browser.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="UTF-8" />
</head>

<body><a name="top"></a>
  <div class="body-container">
    <header>
      <h1>Dashboard</h1>
      <p>Documentation for <a href="/users/home">users</a>, <a href="/administrators/home">administrators</a> and <a href="/developers">developers</a></p>
    </header>
    <div class="section-container">
      <section class="side navigation">
        <menu class="index"><a class="skip" href="#content">Skip to content</a></menu>
        <ul>
          <li>
            <h2>Dashboard</h2>
            <ul>
              <li><a href="/dashboard">Documentation</a></li>
              <li><a href="/dashboard-sitemap">Visual sitemap</a></li>
              <li><a href="/dashboard-ui">UI index</a></li>
              <li><a href="/dashboard-api">API index</a></li>
              <li><a href="https://github.com/userdashboard/dashboard">Github repository</a></li>
              <li><a href="https://npmjs.com/package/@userdashboard/dashboard">NPM package</a></li>
            </ul>
          </li>
          <li>
            <h2>MaxMind GeoIP module</h2>
            <ul>
              <li><a href="/maxmind-geoip-module">Documentation</a></li>
              <li><a href="/maxmind-geoip-api">API index</a></li>
              <li><a href="https://github.com/userdashboard/maxmind-geoip">Github repository</a></li>
              <li><a href="https://npmjs.com/package/@userdashboard/maxmind-geoip">NPM package</a></li>
            </ul>
          </li>
          <li>
            <h2>Organizations module</h2>
            <ul>
              <li><a href="/organizations-module">Documentation</a></li>
              <li><a href="/organizations-sitemap">Visual sitemap</a></li>
              <li><a href="/organizations-ui">UI index</a></li>
              <li><a href="/organizations-api">API index</a></li>
              <li><a href="https://github.com/userdashboard/organizations">Github repository</a></li>
              <li><a href="https://npmjs.com/package/@userdashboard/organizations">NPM package</a></li>
            </ul>
          </li>
          <li>
            <h2>Stripe Connect module</h2>
            <ul>
              <li><a href="/stripe-connect-module">Documentation</a></li>
              <li><a href="/stripe-connect-sitemap">Visual sitemap</a></li>
              <li><a href="/stripe-connect-ui">UI index</a></li>
              <li><a href="/stripe-connect-api">API index</a></li>
              <li><a href="https://github.com/userdashboard/stripe-connect">Github repository</a></li>
              <li><a href="https://npmjs.com/package/@userdashboard/stripe-connect">NPM package</a></li>
            </ul>
          </li>
          <li>
            <h2>Stripe Subscriptions module</h2>
            <ul>
              <li><a href="/stripe-subscriptions-module">Documentation</a></li>
              <li><a href="/stripe-subscriptions-sitemap">Visual sitemap</a></li>
              <li><a href="/stripe-subscriptions-ui">UI index</a></li>
              <li><a href="/stripe-subscriptions-api">API index</a></li>
              <li><a href="https://github.com/userdashboard/stripe-subscriptions">Github repository</a></li>
              <li><a href="https://npmjs.com/package/@userdashboard/stripe-subscriptions">NPM package</a></li>
            </ul>
          </li>
          <li>
            <h2>Example web app</h2>
            <ul>
              <li><a href="/example-web-app">Documentation</a></li>
              <li><a href="/example-web-app-sitemap">Visual sitemap</a></li>
              <li><a href="/example-web-app-ui">UI index</a></li>
              <li><a href="https://github.com/userdashboard/example-web-app">Github repository</a></li>
            </ul>
          </li>
          <li>
            <h2>Example subscription web app</h2>
            <ul>
              <li><a href="/example-subscription-web-app">Documentation</a></li>
              <li><a href="/example-subscription-web-app-sitemap">Visual sitemap</a></li>
              <li><a href="/example-subscription-web-app-ui">UI index</a></li>
              <li><a href="https://github.com/userdashboard/example-subscription-web-app">Github repository</a></li>
            </ul>
          </li>
        </ul>
      </section>
      <section class="full"><a name="content"></a>
        <div class="content">
          <h1>Stripe Connect module for Dashboard</h1>
          <p><img src="https://github.com/userdashboard/stripe-connect/workflows/test-and-publish/badge.svg?branch=master" alt="Test suite status" /></p>
          <p>Dashboard bundles everything a web app needs, all the &quot;boilerplate&quot; like signing in and changing passwords, into a parallel server so you can write a much smaller web app.</p>
          <p>The Stripe Connect module adds a complete &quot;custom&quot; integration of Stripe's Connect API, allowing your users to provide personal or company information and receive payouts on your platform. A complete UI is provided for users to create and manage their registrations, and a basic administrator UI is provided for oversight but has limited functionality so far.</p>
          <p>Your application server can use the Stripe Connect module's API to ensure the user has a valid Connect account with payouts enabled.</p>
          <p>Currently only automatic payouts are supported. Countries that are &quot;in beta&quot; support by Stripe are not supported and need to be added as they become generally available.</p>
          <h2>Import this module</h2>
          <p>Install the module with NPM:</p>
          <pre><code data-language="js">$ npm install @userdashboard/stripe-connect
</code></pre>
          <p>Edit your <code data-language="js">package.json</code> to activate the module:</p>
          <pre><code data-language="js">&quot;dashboard&quot;: {
  &quot;modules&quot;: [
    &quot;@userdashboard/stripe-connect&quot;
  ]
}
</code></pre>
          <h2>Setting up your Stripe credentials</h2>
          <p>You will need to retrieve various keys from <a href="https://stripe.com">Stripe</a>. During development your webhook will be created automatically, but in production with multiple dashboard server instances they share a configured webhook:</p>
          <ul>
            <li>create your Stripe account and find your API keys</li>
            <li>create a webhook for https://your_domain/webhooks/connect/index-connect-data</li>
            <li>environment STRIPE_KEY=sk_test_xxxxxxx</li>
            <li>environment STRIPE_PUBLISHABLE_KEY=pk_test_xxxxxxx</li>
            <li>environment CONNECT_WEBHOOK_ENDPOINT_SECRET=whsec_xxxxxxxx</li>
          </ul>
          <h2>Integrating the Connect platform information</h2>
          <p>When a user has completed a Stripe account registration and it has been approved by Stripe their status will be changed to <code data-language="js">payouts_enabled</code>. Your application should use this information to control access to your platform functionality.</p>
          <h3>Request Connect data from your application server</h3>
          <p>Dashboard and official modules are completely API-driven and you can access the same APIs on behalf of the user making requests. You perform <code data-language="js">GET</code>, <code data-language="js">POST</code>, <code data-language="js">PATCH</code>, and <code data-language="js">DELETE</code> HTTP requests against the API endpoints to fetch or modify data. This example uses NodeJS to fetch the user's organizations from the Dashboard server, your application server can be in any language.</p>
          <p>You can view API documentation within the NodeJS modules' <code data-language="js">api.txt</code> files, or on the <a href="https://userdashboard.github.io/stripe-connect-api">documentation site</a>.</p>
          <pre><code data-language="js">const stripeAccounts = await proxy(`/api/user/connect/stripe-accounts?accountid=${accountid}&amp;all=true`, accountid, sessionid)

const proxy = util.promisify((path, accountid, sessionid, callback) =&gt; {
    let hashText
    if (accountid) {
        hashText = `${process.env.APPLICATION_SERVER_TOKEN}/${accountid}/${sessionid}`
    } else {
        hashText = process.env.APPLICATION_SERVER_TOKEN
    }
    const salt = bcrypt.genSaltSync(4)
    const token = bcrypt.hashSync(hashText, salt)
    const requestOptions = {
        host: 'dashboard.example.com',
        path: path,
        port: '443',
        method: 'GET',
        headers: {
            'x-application-server': 'application.example.com',
            'x-dashboard-token': token
        }
    }
    if (accountid) {
        requestOptions.headers['x-accountid'] = accountid
        requestOptions.headers['x-sessionid'] = sessionid
    }
    const proxyRequest = require('https').request(requestOptions, (proxyResponse) =&gt; {
        let body = ''
        proxyResponse.on('data', (chunk) =&gt; {
            body += chunk
        })
        return proxyResponse.on('end', () =&gt; {
            return callback(null, JSON.parse(body))
        })
    })
    proxyRequest.on('error', (error) =&gt; {
        return callback(error)
    })
    return proxyRequest.end()
  })
}
</code></pre>
        </div>
        <p><a class="skip" href="#top">Top of page</a></p>
      </section>
    </div>
  </div>
</body>

</html>